<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.Pawfect.mapper.ReviewMapper">

    <select id="selectReviewsByContentId" resultType="com.example.Pawfect.dto.ReviewDto">
        SELECT reviewId, contentId, userId, reviewRating, reviewContent, reviewRegdate
        FROM review
        WHERE contentId = #{contentId}
        ORDER BY reviewRegdate DESC
    </select>

    <!-- 리뷰 저장 -->
    <insert id="insertReview" parameterType="map">
	    <selectKey keyProperty="reviewId" resultType="int" order="AFTER">
	        SELECT LAST_INSERT_ID()
	    </selectKey>
	    INSERT INTO review(contentId, userId, reviewContent, reviewRating)
	    VALUES(#{contentId}, #{userId}, #{reviewContent}, #{reviewRating})
	</insert>

    <!-- 마지막 삽입된 reviewId 가져오기 -->
    <select id="getLastInsertedReviewId" resultType="int">
        SELECT LAST_INSERT_ID()
    </select>

    <!-- 리뷰 이미지 저장 -->
    <insert id="insertReviewImageWithOrder">
        INSERT INTO review_images(reviewId, reviewImage, reviewImageOrder)
        VALUES(#{reviewId}, #{imagePath}, #{imageOrder})
    </insert>
    
    <select id="selectReviewImagesByOrder" resultType="String">
        SELECT reviewImage
        FROM review_images
        WHERE reviewId = #{contentId}
        ORDER BY reviewImageOrder
    </select>

</mapper>




